-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.article_views (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  article_id bigint,
  viewed_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  country text DEFAULT 'Unknown'::text,
  city text DEFAULT 'Unknown'::text,
  device_type text DEFAULT 'Unknown'::text,
  ip_hash text,
  CONSTRAINT article_views_pkey PRIMARY KEY (id),
  CONSTRAINT article_views_article_id_fkey FOREIGN KEY (article_id) REFERENCES public.articles(id)
);
CREATE TABLE public.articles (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  slug text NOT NULL UNIQUE,
  title text NOT NULL,
  excerpt text,
  content text,
  image text,
  category_id bigint,
  type text,
  date date,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT articles_pkey PRIMARY KEY (id),
  CONSTRAINT articles_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.categories(id)
);
CREATE TABLE public.categories (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  slug text NOT NULL UNIQUE,
  name text NOT NULL,
  description text,
  topics ARRAY,
  image text,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  order_index integer DEFAULT 0,
  display_order integer DEFAULT 0,
  CONSTRAINT categories_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_permissions (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  user_id bigint,
  category_id bigint,
  can_add boolean DEFAULT false,
  can_edit boolean DEFAULT false,
  can_delete boolean DEFAULT false,
  CONSTRAINT user_permissions_pkey PRIMARY KEY (id),
  CONSTRAINT user_permissions_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id),
  CONSTRAINT user_permissions_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.categories(id)
);
CREATE TABLE public.users (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  username text NOT NULL UNIQUE,
  password text NOT NULL,
  is_superadmin boolean DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT users_pkey PRIMARY KEY (id)
);

-- ADDED TABLES FOR UPDATES

CREATE TABLE public.social_links (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  platform text not null,
  url text not null,
  icon text,
  is_active boolean default true,
  sort_order integer default 0,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  CONSTRAINT social_links_pkey PRIMARY KEY (id)
);

CREATE TABLE public.authors (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  name text not null,
  image text,
  bio text,
  role text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  CONSTRAINT authors_pkey PRIMARY KEY (id)
);

-- Modified articles table
-- ALTER TABLE public.articles ADD COLUMN IF NOT EXISTS author_id bigint REFERENCES public.authors(id) ON DELETE SET NULL;

CREATE TABLE public.homepage_sections (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  type text not null,
  title text,
  category_id bigint,
  display_order integer default 0,
  is_active boolean default true,
  settings jsonb default '{}'::jsonb,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  CONSTRAINT homepage_sections_pkey PRIMARY KEY (id),
  CONSTRAINT homepage_sections_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.categories(id)
);
